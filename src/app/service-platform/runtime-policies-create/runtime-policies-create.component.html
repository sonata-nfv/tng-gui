<h3 class="title3 header-section-name" i18n="@@runtimePolicies">Runtime policies</h3>

<form [formGroup]="policyForm" class="title-section">
	<mat-form-field class="title1">
		<input matInput type="text" placeholder="Policy Name" formControlName="name" required i18n-placeholder="@@policyNamePlaceholder" />
	</mat-form-field>

	<div class="header-buttons">
		<button [ngClass]="{ 'disabled-button': disabledButton }" class="edit-options save" [disabled]="disabledButton"
			(click)="createPolicy()" i18n="@@saveButton">
			SAVE
		</button>
		<button class="edit-options cancel" (click)="close()" i18n="@@cancelButton">CANCEL</button>
	</div>
</form>

<form [formGroup]="policyForm">
	<mat-checkbox formControlName="default" i18n="@@markAsDefault">Mark as default</mat-checkbox>

	<app-select-uuid class="select" placeholder="Network Service" [list]="nsList" (selectEvent)="receiveNS($event)"
		i18n-placeholder="@@nsPlaceholder">
	</app-select-uuid>

	<app-select-uuid class="select" placeholder="SLA template" [list]="slaList" (selectEvent)="receiveSLA($event)"
		i18n-placeholder="@@slaPlaceholder">
	</app-select-uuid>
</form>

<div class="rules-section">
	<h2 class="title2" i18n="@@monitoringRules">Monitoring rules</h2>

	<form [formGroup]="policyForm">
		<!-- TODO include form with name, description, duration, duration unit, threshold and conditions -->

		<div class="description">
			<div class="description-title">
				<h4 class="title4" i18n="@@monitoringRules">Monitoring rules</h4>
				<button *ngIf="!editMonitoringRules" type="button" mat-button matTooltip="Edit" class="icon-button-shadow"
					(click)="editMonitoringRules = true" i18n-matTooltip="@@edit">
					<i class="wui wui-pen-alt"></i>
				</button>
				<button *ngIf="editMonitoringRules" type="button" mat-button matTooltip="View" class="icon-button-shadow"
					(click)="editMonitoringRules = false" i18n-matTooltip="@@view">
					<i class="wui wui-eye"></i>
				</button>
			</div>

			<mat-form-field *ngIf="editMonitoringRules" class="description" [ngClass]="{ 'mat-form-field-invalid': !isValidJSON() }">
				<textarea class="content" matInput type="text" formControlName="monitoringRules" ngDefaultControl></textarea>
				<p *ngIf="!isValidJSON()" class="error-message">*This is not a valid JSON</p>
			</mat-form-field>

			<span *ngIf="!editMonitoringRules" class="content">
				<ngx-json-viewer [json]="getParsedJSON(policyForm.get('monitoringRules').value)"></ngx-json-viewer>
			</span>
		</div>
	</form>
</div>

<div class="rules-section">
	<h2 class="title2" i18n="@@policyRules">Policy rules</h2>

	<!-- TODO here goes a table with introduced policies -->

	<!-- TODO here goes the form for rules -->

</div>


<app-spinner *ngIf="loading"></app-spinner>